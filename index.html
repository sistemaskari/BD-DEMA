<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXPEDIENTES DEMA - Gestión de Documentos</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getStorage, ref, uploadBytes, getDownloadURL, listAll, deleteObject } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCRRDUfJFAEF3c9lly8tOnIinBrkWoONhk",
            authDomain: "dema-expedientes.firebaseapp.com",
            projectId: "dema-expedientes",
            storageBucket: "dema-expedientes.appspot.com",
            messagingSenderId: "606027989070",
            appId: "1:606027989070:web:20965dbcf1d38ba6dc031f"
        };

        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        document.getElementById('login-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === "umecasca@gmail.com" && password === "2025DEMA") {
                document.querySelector('.login-container').style.display = 'none';
                document.getElementById('document-section').style.display = 'block';
            } else {
                document.getElementById('error-message').textContent = 'Usuario o contraseña incorrectos.';
            }
        });

        async function subirPDF() {
            const fileInput = document.getElementById("uploadPDF");
            const pdfFile = fileInput.files[0];
            const area = document.getElementById("area").value;
            const folder = document.getElementById("folder").value.trim() || "General";
            const subfolder = document.getElementById("subfolder").value.trim() || "Sin subcarpeta";

            if (!pdfFile) {
                alert("Selecciona un archivo PDF.");
                return;
            }

            const storageRef = ref(storage, `expedientes/${area}/${folder}/${subfolder}/${pdfFile.name}`);

            try {
                await uploadBytes(storageRef, pdfFile);
                alert("PDF subido con éxito.");
                fileInput.value = "";
                mostrarPDFs();
            } catch (error) {
                console.error("Error al subir el archivo:", error);
                alert("Error al subir el archivo.");
            }
        }

        async function mostrarPDFs() {
            const storageRef = ref(storage, "expedientes/");
            const pdfListDiv = document.getElementById("pdfList");
            pdfListDiv.innerHTML = "";

            try {
                const archivos = await listAll(storageRef);
                archivos.items.forEach(async (itemRef) => {
                    const url = await getDownloadURL(itemRef);
                    const pdfItem = document.createElement("div");
                    pdfItem.classList.add("file-item");
                    pdfItem.innerHTML = `<a href="#" onclick="verPDF('${url}');">${itemRef.name}</a>`;
                    pdfListDiv.appendChild(pdfItem);
                });
            } catch (error) {
                console.error("Error al listar archivos:", error);
            }
        }

        window.verPDF = function (url) {
            document.getElementById("pdfViewer").src = url;
            document.getElementById("pdfViewer").style.display = "block";
        };

        window.onload = mostrarPDFs;
    </script>
    <style>
        /* Tu estilo aquí */
    </style>
</head>
<body>
    <div class="login-container">
        <h2>EXPEDIENTES DEMA</h2>
        <form id="login-form">
            <label for="username">Usuario:</label>
            <input type="text" id="username" required>
            <label for="password">Contraseña:</label>
            <input type="password" id="password" required>
            <button type="submit">Iniciar Sesión</button>
        </form>
        <p id="error-message" class="error"></p>
    </div>

    <div class="container" id="document-section" style="display:none;">
        <h2>Gestión de Documentos PDF</h2>
        <select id="area">
            <option value="medica">Área Médica</option>
            <option value="pedagogia">Pedagogía</option>
            <option value="criminologia">Criminología</option>
            <option value="psicologia">Psicología</option>
            <option value="direccion">Dirección</option>
            <option value="trabajo_social">Trabajo Social</option>
            <option value="juridico">Jurídico</option>
            <option value="horario_actividades">Horario de Actividades</option>
        </select>
        <input type="text" id="folder" placeholder="Ejemplo: Expedientes">
        <input type="text" id="subfolder" placeholder="Ejemplo: Documentos Importantes">
        <input type="file" id="uploadPDF" accept="application/pdf">
        <button onclick="subirPDF()">Subir PDF</button>
        <h3>Expedientes Guardados</h3>
        <div id="pdfList"></div>
        <iframe id="pdfViewer" class="pdf-viewer"></iframe>
    </div>
</body>
</html>

